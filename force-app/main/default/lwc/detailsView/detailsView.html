<!--
  Details View (right pane)
  - Top 30%: List View (campaign buttons for selected week)
  - Bottom 70%: Edit View (name + description + status + non-editable time period)
  Behavior:
  - When week changes, loads campaigns for that week.
  - If only one campaign, auto-open it while still listing it.
  - Button colors match calendar: green if owned by current user, grey otherwise.
  - Save on blur using lightning-record-edit-form submit.
-->
<template>
  <section class="slds-grid slds-wrap details-root">
    <!-- List View -->
    <div class="slds-col slds-size_1-of-1 list-pane">
      <div class="slds-text-title_caps slds-p-around_x-small">Viikon {weekNumber} Kampanjat</div>
      <div class="list-scroll">
        <template if:true={hasWeek}>
          <template if:true={hasCampaigns}>
          <template for:each={campaignsWithClasses} for:item="c">
            <div
              key={c.id}
              data-id={c.id}
              class={c.itemClass}
              onclick={handleSelect}
              role="button"
              tabindex="0"
              onkeydown={handleItemKeydown}
              title={c.name}
            >
              <span class="item-label">{c.name}</span>
            </div>
          </template>
          </template>
          <template if:false={hasCampaigns}>
            <div class="slds-p-around_small slds-text-color_weak">Ei kampanjoita tällä viikolla.</div>
          </template>
        </template>
        <template if:false={hasWeek}>
          <div class="slds-p-around_small slds-text-color_weak">Valitse viikko nähdäksesi sen kampanjat</div>
        </template>
      </div>
    </div>

    <!-- Edit View -->
    <div class="slds-col slds-size_1-of-1 edit-pane">
      <div class="slds-text-title_caps slds-p-horizontal_x-small slds-p-top_x-small">Kampanjan Tiedot</div>
      <template if:true={selectedCampaignId}>
        <div class="slds-p-around_small slds-grid slds-wrap slds-gutters_small">
          <!-- Name -->
          <div class="slds-col slds-size_1-of-1">
            <lightning-input
              type="text"
              label="Kampanjan Nimi"
              value={nameValue}
              onchange={handleNameChange}
            ></lightning-input>
          </div>

          <!-- Time Period (read-only formatted) -->
          <div class="slds-col slds-size_1-of-1">
            <label class="slds-form-element__label">Kampanjan Aikaväli</label>
            <div class="slds-form-element__control">
              <div class="slds-text-color_weak">{timePeriodText}</div>
            </div>
          </div>

          <!-- Description -->
          <div class="slds-col slds-size_1-of-1">
            <lightning-input-rich-text
              label-visible
              label="Kampanjan Kuvaus"
              value={descriptionValue}
              onchange={handleDescriptionChange}
            ></lightning-input-rich-text>
          </div>

          <!-- Confirmation Status (read-only display) -->
          <div class="slds-col slds-size_1-of-1">
            <label class="slds-form-element__label">Kampanjan Tilanne</label>
            <div class="slds-form-element__control">
              <div class="slds-input slds-text-color_weak slds-truncate" title={statusText}>{statusText}</div>
            </div>
          </div>

          <!-- Campaign Items -->
          <div class="slds-col slds-size_1-of-1">
            <div class="slds-m-top_small">
              <div class="slds-text-title_caps slds-p-bottom_x-small">Kampanjan Tuotteet</div>
              <div class="slds-grid slds-wrap slds-gutters_xx-small">
                <template for:each={selectedCampaignItems} for:item="it">
                  <div key={it.id} class="slds-m-right_xx-small slds-m-bottom_xx-small">
                    <lightning-pill class="campaign-item-pill" label={it.itemName} data-id={it.id} onclick={handleItemInfoClick}></lightning-pill>
                  </div>
                </template>
                <template if:true={selectedCampaignItemsIsEmpty}>
                  <div class="slds-text-color_weak slds-p-vertical_xx-small">Ei tuotteita.</div>
                </template>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="slds-col slds-size_1-of-1 slds-m-top_small">
            <lightning-button
              variant="brand"
              label="Tallenna"
              onclick={handleSave}
              disabled={isSaving}
            ></lightning-button>
            <template if:true={isSaving}>
              <lightning-spinner size="small" alternative-text="Tallennetaan..."></lightning-spinner>
            </template>
          </div>
        </div>
      </template>
      <template if:false={selectedCampaignId}>
        <div class="slds-p-around_small slds-text-color_weak">Valitse kampanja nähdäksesi sen tiedot.</div>
      </template>
    </div>
  </section>
</template>
